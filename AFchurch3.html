<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>성경구절 암송 프로그램</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        /* 스크롤바 디자인 */
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-thumb {
            background-color: #a0aec0;
            border-radius: 4px;
        }
        textarea::-webkit-scrollbar-track {
            background-color: #edf2f7;
        }
        /* 음성 입력 중일 때 아이콘 애니메이션 */
        .recording {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div id="app-container" class="w-full max-w-2xl mx-auto p-4 sm:p-6">
        
        <!-- 1. 첫 화면: 직분 선택 -->
        <div id="home-screen" class="text-center bg-white p-8 rounded-2xl shadow-lg">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">성경구절 암송 프로그램</h1>
            <p class="text-gray-600 mb-8">직분을 선택해주세요.</p>
            <div class="space-y-4">
                <button onclick="startQuiz('장로')" class="w-full bg-blue-600 text-white font-bold py-4 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-300 text-lg shadow-md">
                    장로
                </button>
                <button onclick="startQuiz('안수집사 및 권사')" class="w-full bg-green-600 text-white font-bold py-4 px-6 rounded-lg hover:bg-green-700 transition-colors duration-300 text-lg shadow-md">
                    안수집사 및 권사
                </button>
            </div>
        </div>

        <!-- 2. 암송 테스트 화면 -->
        <div id="quiz-screen" class="hidden bg-white p-6 sm:p-8 rounded-2xl shadow-lg relative">
            
            <!-- 상단 헤더: 홈 버튼, 진행도, 점수 -->
            <div class="flex justify-between items-center mb-6 border-b pb-4">
                <button onclick="goHome()" class="text-gray-500 hover:text-blue-600 font-semibold transition-colors">
                    &larr; 홈으로
                </button>
                <div id="quiz-progress" class="text-lg font-bold text-gray-700"></div>
                <div id="quiz-score" class="text-lg font-bold text-blue-600"></div>
            </div>

            <div>
                <!-- 문제 (성경 구절) -->
                <div class="mb-4 text-center">
                    <p class="text-gray-500 text-sm">아래의 성경 구절을 암송하여 적어주세요.</p>
                    <h2 id="verse-reference" class="text-3xl font-bold text-gray-800 mt-1"></h2>
                </div>

                <!-- 사용자 답안 입력 칸 -->
                <textarea id="user-answer" rows="5" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition text-lg" placeholder="이곳에 암송한 구절을 입력하세요..."></textarea>

                <!-- 결과 메시지 -->
                <p id="result-message" class="mt-2 text-center font-bold h-6"></p>

                <!-- 버튼 (답 제출, 음성 입력, 힌트, 정답 확인) -->
                <div class="grid grid-cols-2 gap-4 mt-4">
                    <button onclick="checkAnswer()" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors duration-300 shadow-sm">답 제출</button>
                    <button id="voice-input-button" onclick="toggleVoiceInput()" class="w-full bg-orange-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-orange-600 transition-colors duration-300 shadow-sm flex items-center justify-center">
                        <svg id="mic-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="22"></line></svg>
                        <span id="voice-input-text" class="ml-2">음성 입력</span>
                    </button>
                    <button id="hint-button" onclick="toggleHint()" class="w-full bg-gray-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-600 transition-colors duration-300 shadow-sm">힌트 보기</button>
                    <button id="show-answer-button" onclick="toggleAnswer()" class="w-full bg-teal-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-600 transition-colors duration-300 shadow-sm">정답 확인</button>
                </div>

                <!-- 힌트 제공 칸 -->
                <div id="hint-box" class="hidden mt-4 p-4 bg-yellow-100 border border-yellow-300 text-yellow-800 rounded-lg text-center break-all">
                    <p id="hint-text" class="text-lg"></p>
                </div>
                
                <!-- 정답 제공 칸 -->
                <div id="answer-box" class="hidden mt-4 p-4 bg-green-100 border border-green-300 text-green-800 rounded-lg">
                    <p class="font-bold mb-1">정답</p>
                    <p id="answer-text" class="text-lg"></p>
                </div>

                <!-- 이전/다음 문제 이동 버튼 -->
                <div class="flex justify-between mt-8">
                    <button onclick="navigateVerse(-1)" class="bg-gray-200 text-gray-700 font-semibold py-2 px-5 rounded-lg hover:bg-gray-300 transition-colors">&larr; 이전</button>
                    <button onclick="navigateVerse(1)" class="bg-gray-200 text-gray-700 font-semibold py-2 px-5 rounded-lg hover:bg-gray-300 transition-colors">다음 &rarr;</button>
                </div>
            </div>
        </div>

        <!-- 3. 최종 점수 화면 -->
        <div id="score-screen" class="hidden text-center bg-white p-8 rounded-2xl shadow-lg">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">수고하셨습니다!</h2>
            <p id="final-score" class="text-4xl font-bold text-indigo-600 mb-8"></p>
            <button onclick="goHome()" class="w-full bg-blue-600 text-white font-bold py-4 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-300 text-lg shadow-md">
                홈으로 돌아가기
            </button>
        </div>

    </div>

    <script>
        // --- 데이터셋 (개역개정 NKRV) ---
        const bibleData = {
            '장로': [
                { reference: '요한복음 3:16 (NKRV)', text: '하나님이 세상을 이처럼 사랑하사 독생자를 주셨으니 이는 그를 믿는 자마다 멸망하지 않고 영생을 얻게 하려 하심이라' },
                { reference: '요한복음 10:10 (NKRV)', text: '도둑이 오는 것은 도둑질하고 죽이고 멸망시키려는 것뿐이요 내가 온 것은 양으로 생명을 얻게 하고 더 풍성히 얻게 하려는 것이라' },
                { reference: '로마서 3:23 (NKRV)', text: '모든 사람이 죄를 범하였으매 하나님의 영광에 이르지 못하더니' },
                { reference: '로마서 6:23 (NKRV)', text: '죄의 삯은 사망이요 하나님의 은사는 그리스도 예수 우리 주 안에 있는 영생이니라' },
                { reference: '로마서 5:8 (NKRV)', text: '우리가 아직 죄인 되었을 때에 그리스도께서 우리를 위하여 죽으심으로 하나님께서 우리에 대한 자기의 사랑을 확증하셨느니라' },
                { reference: '요한복음 14:6 (NKRV)', text: '예수께서 이르시되 내가 곧 길이요 진리요 생명이니 나로 말미암지 않고는 아버지께로 올 자가 없느니라' },
                { reference: '요한복음 1:12 (NKRV)', text: '영접하는 자 곧 그 이름을 믿는 자들에게는 하나님의 자녀가 되는 권세를 주셨으니' },
                { reference: '에베소서 2:8–9 (NKRV)', text: '너희는 그 은혜에 의하여 믿음으로 말미암아 구원을 받았으니 이것은 너희에게서 난 것이 아니요 하나님의 선물이라 행위에서 난 것이 아니니 이는 누구든지 자랑하지 못하게 함이라' },
                { reference: '히브리서 9:27 (NKRV)', text: '한 번 죽는 것은 사람에게 정해진 것이요 그 후에는 심판이 있으리니' },
                { reference: '요한복음 5:24 (NKRV)', text: '내가 진실로 진실로 너희에게 이르노니 내 말을 듣고 또 나 보내신 이를 믿는 자는 영생을 얻었고 심판에 이르지 아니하나니 사망에서 생명으로 옮겼느니라' },
                { reference: '요한계시록 3:20 (NKRV)', text: '볼지어다 내가 문 밖에 서서 두드리노니 누구든지 내 음성을 듣고 문을 열면 내가 그에게로 들어가 그와 더불어 먹고 그는 나와 더불어 먹으리라' },
                { reference: '에베소서 4:12 (NKRV)', text: '이는 성도를 온전하게 하여 봉사의 일을 하게 하며 그리스도의 몸을 세우려 하심이라' },
                { reference: '이사야 41:10 (NKRV)', text: '두려워하지 말라 내가 너와 함께 함이라 놀라지 말라 나는 네 하나님이 됨이라 내가 너를 굳세게 하리라 참으로 너를 도와 주리라 참으로 나의 의로운 오른손으로 너를 붙들리라' },
                { reference: '예레미야 33:3 (NKRV)', text: '너는 내게 부르짖으라 내가 네게 응답하겠고 네가 알지 못하는 크고 은밀한 일을 네게 보이리라' },
                { reference: '마태복음 6:33 (NKRV)', text: '그런즉 너희는 먼저 그의 나라와 그의 의를 구하라 그리하면 이 모든 것을 너희에게 더하시리라' },
                { reference: '여호수아 1:8 (NKRV)', text: '이 율법책을 네 입에서 떠나지 말게 하며 주야로 그것을 묵상하여 그 안에 기록된 대로 다 지켜 행하라 그리하면 네 길이 평탄하게 될 것이며 네가 형통하리라' },
                { reference: '빌립보서 4:6–7 (NKRV)', text: '아무 것도 염려하지 말고 다만 모든 일에 기도와 간구로, 너희 구할 것을 감사함으로 하나님께 아뢰라 그리하면 모든 지각에 뛰어난 하나님의 평강이 그리스도 예수 안에서 너희 마음과 생각을 지키시리라' },
                { reference: '잠언 16:9 (NKRV)', text: '사람이 마음으로 자기의 길을 계획할지라도 그의 걸음을 인도하시는 이는 여호와시니라' },
                { reference: '하박국 3:18 (NKRV)', text: '나는 여호와로 말미암아 즐거워하며 나의 구원의 하나님으로 말미암아 기뻐하리로다' },
                { reference: '고린도후서 9:7 (NKRV)', text: '각각 그 마음에 정한 대로 할 것이요 인색함으로나 억지로 하지 말지니 하나님은 즐겨 내는 자를 사랑하시느니라' },
                { reference: '디모데후서 3:16 (NKRV)', text: '모든 성경은 하나님의 감동으로 된 것으로 교훈과 책망과 바르게 함과 의로 교육하기에 유익하니' },
                { reference: '사도행전 1:8 (NKRV)', text: '오직 성령이 너희에게 임하시면 너희가 권능을 받고 예루살렘과 온 유대와 사마리아와 땅 끝까지 이르러 내 증인이 되리라 하시니라' },
                { reference: '로마서 15:2 (NKRV)', text: '우리 각 사람이 이웃을 기쁘게 하되 선을 이루고 덕을 세우도록 할지니라' },
                { reference: '사도행전 13:52 (NKRV)', text: '제자들은 기쁨과 성령이 충만하니라' },
                { reference: '요한복음 5:39 (NKRV)', text: '너희가 성경에서 영생을 얻는 줄 생각하고 성경을 연구하거니와 이 성경이 곧 내게 대하여 증언하는 것이니라' },
                { reference: '사도행전 20:35 (NKRV)', text: '범사에 여러분에게 모본을 보여준 바와 같이 수고하여 약한 사람들을 돕고 또 주 예수께서 친히 말씀하신 바 주는 것이 받는 것보다 복이 있다 하심을 기억하여야 할지니라' },
                { reference: '에베소서 4:32 (NKRV)', text: '서로 친절하게 하며 불쌍히 여기며 서로 용서하기를 하나님이 그리스도 안에서 너희를 용서하심과 같이 하라' },
                { reference: '요한1서 3:18 (NKRV)', text: '자녀들아 우리가 말과 혀로만 사랑하지 말고 행함과 진실함으로 하자' },
                { reference: '요한계시록 2:7 (NKRV)', text: '귀 있는 자는 성령이 교회들에게 하시는 말씀을 들을지어다 이기는 그에게는 내가 하나님의 낙원에 있는 생명나무의 열매를 주어 먹게 하리라' },
                { reference: '요한계시록 3:19 (NKRV)', text: '무릇 내가 사랑하는 자를 책망하여 징계하노니 그러므로 네가 열심을 내라 회개하라' }
            ],
            '안수집사 및 권사': [
                { reference: '요한복음 3:16 (NKRV)', text: '하나님이 세상을 이처럼 사랑하사 독생자를 주셨으니 이는 그를 믿는 자마다 멸망하지 않고 영생을 얻게 하려 하심이라' },
                { reference: '요한복음 10:10 (NKRV)', text: '도둑이 오는 것은 도둑질하고 죽이고 멸망시키려는 것뿐이요 내가 온 것은 양으로 생명을 얻게 하고 더 풍성히 얻게 하려는 것이라' },
                { reference: '로마서 3:23 (NKRV)', text: '모든 사람이 죄를 범하였으매 하나님의 영광에 이르지 못하더니' },
                { reference: '로마서 6:23 (NKRV)', text: '죄의 삯은 사망이요 하나님의 은사는 그리스도 예수 우리 주 안에 있는 영생이니라' },
                { reference: '로마서 5:8 (NKRV)', text: '우리가 아직 죄인 되었을 때에 그리스도께서 우리를 위하여 죽으심으로 하나님께서 우리에 대한 자기의 사랑을 확증하셨느니라' },
                { reference: '요한복음 14:6 (NKRV)', text: '예수께서 이르시되 내가 곧 길이요 진리요 생명이니 나로 말미암지 않고는 아버지께로 올 자가 없느니라' },
                { reference: '요한복음 1:12 (NKRV)', text: '영접하는 자 곧 그 이름을 믿는 자들에게는 하나님의 자녀가 되는 권세를 주셨으니' },
                { reference: '에베소서 2:8–9 (NKRV)', text: '너희는 그 은혜에 의하여 믿음으로 말미암아 구원을 받았으니 이것은 너희에게서 난 것이 아니요 하나님의 선물이라 행위에서 난 것이 아니니 이는 누구든지 자랑하지 못하게 함이라' },
                { reference: '히브리서 9:27 (NKRV)', text: '한 번 죽는 것은 사람에게 정해진 것이요 그 후에는 심판이 있으리니' },
                { reference: '요한복음 5:24 (NKRV)', text: '내가 진실로 진실로 너희에게 이르노니 내 말을 듣고 또 나 보내신 이를 믿는 자는 영생을 얻었고 심판에 이르지 아니하나니 사망에서 생명으로 옮겼느니라' },
                { reference: '요한계시록 3:20 (NKRV)', text: '볼지어다 내가 문 밖에 서서 두드리노니 누구든지 내 음성을 듣고 문을 열면 내가 그에게로 들어가 그와 더불어 먹고 그는 나와 더불어 먹으리라' },
                { reference: '요한1서 5:11–13 (NKRV)', text: '또 증거는 이것이니 하나님이 우리에게 영생을 주신 것과 이 생명이 그의 아들 안에 있는 그것이니라 아들이 있는 자에게는 생명이 있고 하나님의 아들이 없는 자에게는 생명이 없느니라 내가 하나님의 아들의 이름을 믿는 너희에게 이것을 쓰는 것은 너희로 하여금 너희에게 영생이 있음을 알게 하려 함이라' },
                { reference: '고린도전서 15:3–4 (NKRV)', text: '내가 받은 것을 먼저 너희에게 전하였노니 이는 성경대로 그리스도께서 우리 죄를 위하여 죽으시고 장사 지낸 바 되셨다가 성경대로 사흘 만에 다시 살아나사' },
                { reference: '로마서 12:1–2 (NKRV)', text: '그러므로 형제들아 내가 하나님의 모든 자비하심으로 너희를 권하노니 너희 몸을 하나님이 기뻐하시는 거룩한 산 제물로 드리라 이는 너희가 드릴 영적 예배니라 너희는 이 세대를 본받지 말고 오직 마음을 새롭게 함으로 변화를 받아 하나님의 선하시고 기뻐하시고 온전하신 뜻이 무엇인지 분별하도록 하라' },
                { reference: '요한1서 4:21 (NKRV)', text: '우리가 이 계명을 주께 받았나니 하나님을 사랑하는 자는 또한 그 형제를 사랑할지니라' }
            ]
        };

        // --- 상태 변수 ---
        let currentRole = '';
        let currentVerseIndex = 0;
        let isHintVisible = false;
        let isAnswerVisible = false;
        let shuffledVerses = [];
        let correctAnswersCount = 0;
        let isRecognizing = false; // 음성 인식 상태

        // --- DOM 요소 ---
        const homeScreen = document.getElementById('home-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const scoreScreen = document.getElementById('score-screen');
        const verseReferenceEl = document.getElementById('verse-reference');
        const userAnswerEl = document.getElementById('user-answer');
        const resultMessageEl = document.getElementById('result-message');
        const hintBoxEl = document.getElementById('hint-box');
        const hintTextEl = document.getElementById('hint-text');
        const hintButton = document.getElementById('hint-button');
        const answerBoxEl = document.getElementById('answer-box');
        const answerTextEl = document.getElementById('answer-text');
        const showAnswerButton = document.getElementById('show-answer-button');
        const quizProgressEl = document.getElementById('quiz-progress');
        const quizScoreEl = document.getElementById('quiz-score');
        const finalScoreEl = document.getElementById('final-score');
        const voiceInputButton = document.getElementById('voice-input-button');
        const voiceInputText = document.getElementById('voice-input-text');
        const micIcon = document.getElementById('mic-icon');

        // --- 음성 인식 API 설정 ---
        window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        if (window.SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.interimResults = false;
            recognition.lang = 'ko-KR';
            recognition.continuous = true; // 사용자가 중지할 때까지 계속 인식
            recognition.maxAlternatives = 1;
        }

        // --- 함수 ---

        function startQuiz(role) {
            currentRole = role;
            currentVerseIndex = 0;
            correctAnswersCount = 0;
            
            const originalVerses = bibleData[role];
            shuffledVerses = [...originalVerses]
                .map(verse => ({ ...verse, answeredCorrectly: false }))
                .sort(() => Math.random() - 0.5);

            homeScreen.classList.add('hidden');
            scoreScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            loadVerse(currentVerseIndex);
        }

        function goHome() {
            if (isRecognizing) {
                recognition.stop();
            }
            quizScreen.classList.add('hidden');
            scoreScreen.classList.add('hidden');
            homeScreen.classList.remove('hidden');
        }
        
        function loadVerse(index) {
            if (index >= 0 && index < shuffledVerses.length) {
                currentVerseIndex = index;
                const verse = shuffledVerses[currentVerseIndex];
                
                verseReferenceEl.textContent = verse.reference;
                updateHeader();

                userAnswerEl.value = '';
                resultMessageEl.textContent = '';
                resultMessageEl.className = 'mt-2 text-center font-bold h-6';
                hideHint();
                hideAnswer();
            }
        }

        function updateHeader() {
            quizProgressEl.textContent = `${currentVerseIndex + 1} / ${shuffledVerses.length}`;
            quizScoreEl.textContent = `점수: ${correctAnswersCount}점`;
        }

        function navigateVerse(direction) {
            const newIndex = currentVerseIndex + direction;
            if (newIndex >= 0 && newIndex < shuffledVerses.length) {
                loadVerse(newIndex);
            } else if (direction === 1 && newIndex >= shuffledVerses.length) {
                showFinalScore();
            }
        }

        function showFinalScore() {
            quizScreen.classList.add('hidden');
            finalScoreEl.textContent = `최종 점수: ${correctAnswersCount}점`;
            scoreScreen.classList.remove('hidden');
        }

        function checkAnswer() {
            const currentVerse = shuffledVerses[currentVerseIndex];
            
            const correctAnswer = currentVerse.text.replace(/\s/g, '');
            const userAnswer = userAnswerEl.value.replace(/\s/g, '');

            if (userAnswer === correctAnswer) {
                resultMessageEl.textContent = '정답입니다!';
                resultMessageEl.className = 'mt-2 text-center font-bold h-6 text-green-600';
                if (!currentVerse.answeredCorrectly) {
                    correctAnswersCount++;
                    currentVerse.answeredCorrectly = true;
                    updateHeader();
                }
            } else {
                resultMessageEl.textContent = '다시 시도해보세요.';
                resultMessageEl.className = 'mt-2 text-center font-bold h-6 text-red-600';
            }
        }

        function toggleHint() {
            isHintVisible = !isHintVisible;
            if (isHintVisible) showHint(); else hideHint();
        }
        
        function showHint() {
            hideAnswer();
            const currentVerse = shuffledVerses[currentVerseIndex];
            hintTextEl.textContent = getConsonants(currentVerse.text);
            hintBoxEl.classList.remove('hidden');
            hintButton.textContent = '힌트 숨기기';
            hintButton.classList.remove('bg-gray-500', 'hover:bg-gray-600');
            hintButton.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
            isHintVisible = true;
        }

        function hideHint() {
            hintBoxEl.classList.add('hidden');
            hintButton.textContent = '힌트 보기';
            hintButton.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
            hintButton.classList.add('bg-gray-500', 'hover:bg-gray-600');
            isHintVisible = false;
        }

        function toggleAnswer() {
            isAnswerVisible = !isAnswerVisible;
            if (isAnswerVisible) showAnswer(); else hideAnswer();
        }

        function showAnswer() {
            hideHint();
            const currentVerse = shuffledVerses[currentVerseIndex];
            answerTextEl.textContent = currentVerse.text;
            answerBoxEl.classList.remove('hidden');
            showAnswerButton.textContent = '정답 숨기기';
            showAnswerButton.classList.remove('bg-teal-500', 'hover:bg-teal-600');
            showAnswerButton.classList.add('bg-red-500', 'hover:bg-red-600');
            isAnswerVisible = true;
        }

        function hideAnswer() {
            answerBoxEl.classList.add('hidden');
            showAnswerButton.textContent = '정답 확인';
            showAnswerButton.classList.remove('bg-red-500', 'hover:bg-red-600');
            showAnswerButton.classList.add('bg-teal-500', 'hover:bg-teal-600');
            isAnswerVisible = false;
        }

        function getConsonants(str) {
            const initials = ['ㄱ', 'ㄲ', 'ㄴ', 'ㄷ', 'ㄸ', 'ㄹ', 'ㅁ', 'ㅂ', 'ㅃ', 'ㅅ', 'ㅆ', 'ㅇ', 'ㅈ', 'ㅉ', 'ㅊ', 'ㅋ', 'ㅌ', 'ㅍ', 'ㅎ'];
            let result = '';
            for (let i = 0; i < str.length; i++) {
                const char = str[i];
                const code = char.charCodeAt(0);
                if (code >= 0xAC00 && code <= 0xD7A3) {
                    const initialIndex = Math.floor((code - 0xAC00) / (21 * 28));
                    result += initials[initialIndex];
                } else {
                    result += char;
                }
            }
            return result;
        }

        // --- 음성 인식 함수들 ---
        function toggleVoiceInput() {
            if (!recognition) {
                alert("음성 인식 기능이 지원되지 않는 브라우저입니다.");
                return;
            }
            if (isRecognizing) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        if (recognition) {
            recognition.onstart = () => {
                isRecognizing = true;
                voiceInputButton.classList.remove('bg-orange-500', 'hover:bg-orange-600');
                voiceInputButton.classList.add('bg-red-500', 'hover:bg-red-600', 'recording');
                voiceInputText.textContent = "입력 중지";
            };

            recognition.onend = () => {
                isRecognizing = false;
                voiceInputButton.classList.add('bg-orange-500', 'hover:bg-orange-600');
                voiceInputButton.classList.remove('bg-red-500', 'hover:bg-red-600', 'recording');
                voiceInputText.textContent = "음성 입력";
            };

            recognition.onresult = (event) => {
                let transcript = '';
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    transcript += event.results[i][0].transcript;
                }
                userAnswerEl.value += transcript;
            };

            recognition.onerror = (event) => {
                console.error("Speech recognition error:", event.error);
                if (event.error !== 'no-speech') {
                    alert(`음성 인식 오류가 발생했습니다: ${event.error}`);
                }
            };
        }

    </script>
</body>
</html>
